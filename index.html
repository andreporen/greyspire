<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Um Convite Arcano</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=MedievalSharp&family=Lora:ital,wght@0,400;1,400&display=swap" rel="stylesheet">

    <!-- Bibliotecas Essenciais -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>

    <style>
        :root {
            --cor-arcana: #b24cff; /* Roxo principal */
            --cor-arcana-escura: #5a009d; 
            --cor-arcana-clara: #E0B2FF;
            
            /* Tempos de Animação */
            --tempo-explosao-selo: 0.8s;
        }

        /* --- ESTILOS GERAIS E LAYOUT --- */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            color: #ffffff;
            font-family: 'MedievalSharp', cursive;
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        /* --- FUNDO SUTIL (CSS) --- */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: radial-gradient(circle at center, rgba(90, 0, 157, 0.1) 0%, rgba(0,0,0,0) 70%);
            animation: bg-pulse 10s ease-in-out infinite alternate;
            filter: blur(0.5px);
        }

        @keyframes bg-pulse {
            0% { filter: blur(0.5px) brightness(1); }
            50% { filter: blur(1.5px) brightness(1.1); }
            100% { filter: blur(0.5px) brightness(1); }
        }

        /* --- SELO ARCANO (Centralizado e com Aura) --- */
        #seal-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px; 
            height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 99; /* Camada mais alta para clique */
            cursor: pointer;
            transition: opacity var(--tempo-explosao-selo) ease-out;
            opacity: 1; /* Visível no início */
        }
        
        #arcane-seal-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 10px var(--cor-arcana-escura));
            position: absolute;
            z-index: 2; /* Acima da aura */
            /* Animação de pulso inicial do selo */
            animation: pulse-seal-img 2.2s ease-in-out infinite alternate;
        }

        #seal-aura {
            position: absolute;
            width: 150%; 
            height: 150%;
            border-radius: 50%;
            background: radial-gradient(circle at center, var(--cor-arcana-clara) 0%, var(--cor-arcana) 20%, rgba(178, 76, 255, 0.5) 40%, rgba(178, 76, 255, 0) 70%);
            filter: blur(15px);
            z-index: 1; /* Abaixo do selo */
            /* Animação de pulso inicial da aura */
            animation: pulse-seal-aura 2.2s ease-in-out infinite alternate;
        }
        
        @keyframes pulse-seal-aura {
            0% { transform: scale(0.95); opacity: 0.7; }
            100% { transform: scale(1.05); opacity: 1; }
        }
        @keyframes pulse-seal-img {
             0% { filter: drop-shadow(0 0 10px var(--cor-arcana-escura)) brightness(1.0); }
            100% { filter: drop-shadow(0 0 20px var(--cor-arcana)) brightness(1.1); }
        }

        /* Efeito de Explosão do Selo (ativado por JS com classe .clicked) */
        #seal-container.clicked #seal-aura {
            animation: seal-explode-aura var(--tempo-explosao-selo) forwards;
        }
        #seal-container.clicked #arcane-seal-img {
            animation: seal-explode-img var(--tempo-explosao-selo) forwards;
        }

        @keyframes seal-explode-aura {
            0% { transform: scale(1); opacity: 1; filter: blur(15px); }
            100% { transform: scale(5); opacity: 0; filter: blur(50px); }
        }
        @keyframes seal-explode-img {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; filter: drop-shadow(0 0 50px var(--cor-arcana-clara)); }
            100% { transform: scale(0.5); opacity: 0; }
        }
        
        /* --- CENA 3D (THREE.JS) --- */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10; /* Acima do fundo, abaixo do selo (inicialmente) */
            opacity: 0; /* Começa invisível */
            transition: opacity 1.5s ease-in;
        }

        #three-canvas.visible {
            opacity: 1;
        }

        /* --- ASSINATURA FINAL (GLITCH) --- */
        #signature-container {
            display: none; /* Começa oculto */
            opacity: 0;
            position: fixed;
            bottom: 50%; /* Centralizado no final */
            left: 50%;
            transform: translate(-50%, 50%);
            z-index: 20; /* Acima de tudo */
            text-align: center;
            font-size: 2.5rem;
            font-family: 'Cinzel Decorative', serif;
            color: #fff;
            position: relative;
            transition: opacity 1s ease-in;
        }
        
        #signature {
            color: #fff;
            position: relative;
            animation: pulse-arcano-sig 1.2s ease-in-out infinite alternate;
        }
        
        /* Efeito de Corrupção (Glitch/Borramento) */
        #signature::before, #signature::after {
            content: "Arcanista-mor Amaris Solun"; 
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            clip-path: inset(0 0 0 0);
            filter: blur(0.5px);
        }
        
        #signature::before {
            color: #ff00ff; 
            text-shadow: 0 0 3px #ff00ff;
            animation: glitch-clip-1 0.2s steps(2, end) infinite;
        }
        
        #signature::after {
            color: #00ffff; 
            text-shadow: 0 0 3px #00ffff;
            animation: glitch-clip-2 0.3s steps(2, end) infinite;
        }

        @keyframes glitch-clip-1 {
            0% { clip-path: inset(10% 0 85% 0); transform: translateX(5px); }
            50% { clip-path: inset(50% 0 30% 0); transform: translateX(-5px); }
            100% { clip-path: inset(20% 0 70% 0); transform: translateX(5px); }
        }
        
        @keyframes glitch-clip-2 {
            0% { clip-path: inset(30% 0 65% 0); transform: translateX(-3px); }
            50% { clip-path: inset(60% 0 20% 0); transform: translateX(3px); }
            100% { clip-path: inset(45% 0 45% 0); transform: translateX(-3px); }
        }

        @keyframes pulse-arcano-sig {
            0% { text-shadow: 0 0 5px var(--cor-arcana); filter: brightness(1) blur(1.5px); }
            100% { text-shadow: 0 0 15px var(--cor-arcana-clara), 0 0 20px var(--cor-arcana); filter: brightness(1.3) blur(1.5px); }
        }

    </style>
</head>
<body>

    <!-- O Selo (Gatilho) -->
    <div id="seal-container">
        <div id="seal-aura"></div>
        <img id="arcane-seal-img" src="https://placehold.co/150x150/000000/b24cff?text=%E2%9C%93&font=lora" alt="Selo Arcano">
    </div>

    <!-- O Canvas para o Texto 3D -->
    <canvas id="three-canvas"></canvas>

    <!-- A Assinatura (Clímax) -->
    <div id="signature-container">
        <p id="signature">Arcanista-mor Amaris Solun</p>
    </div>

    <!-- 
    ===================================================
    SHADERS (GLSL)
    ===================================================
    -->
    <script type="x-shader/x-vertex" id="vertexShader">
        varying vec2 vUv;
        void main() {
            vUv = uv; 
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    </script>

    <script type="x-shader/x-fragment" id="fragmentShader">
        uniform sampler2D map;
        uniform float time;
        uniform vec3 glowColor;
        uniform float distortionStrength; // Controla a intensidade

        varying vec2 vUv;

        // Função de ruído simples para a distorção
        float rand(vec2 co){
            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
        }

        void main() {
            vec2 distortedUv = vUv;
            
            // Distorção sutil (controlada pelo distortionStrength)
            float noise = (rand(vUv * 10.0 + time * 0.5) - 0.5) * distortionStrength;
            distortedUv.x += sin(vUv.y * 15.0 + time * 2.0) * noise; // Frequência da distorção reduzida
            distortedUv.y += cos(vUv.x * 15.0 + time * 1.5) * noise;

            vec4 texel = texture2D(map, distortedUv);
            
            // Fator de pulsação (brilho)
            float pulseFactor = (sin(time * 2.5) * 0.5 + 0.5) * 0.8 + 0.5; // Pulsa entre 0.5 e 1.3

            // Cor base do texto: Mistura branco e roxo
            vec3 finalColor = mix(vec3(1.0, 1.0, 1.0), glowColor, texel.a * 0.5); // Menos roxo na base
            
            // Adiciona o brilho roxo (glow)
            vec3 purpleGlow = glowColor * texel.a * pulseFactor * 1.5; 
            
            // Combinação final
            finalColor += purpleGlow;

            gl_FragColor = vec4(finalColor, texel.a);
        }
    </script>

    <!-- 
    ===================================================
    JAVASCRIPT (THREE.JS E LÓGICA)
    ===================================================
    -->
    <script>
        // --- TEXTO (LORE COMPLETA) ---
        // NOVO: Texto em prosa (carta), sem a assinatura no final.
        const LOREM_IPSUM_ARCANO = `
Cidade de Greyspire, remanescentes do Velho Império, 537 D.R

Vocês deviam ter percebido, mas a percepção é coisa perigosa por aqui, 
então talvez não notem até que já seja tarde; o mundo não se quebrou 
num só instante, ele vai quebrando aos poucos, como vidro que racha 
sem barulho, e essa lentidão é o que permite que todos finjam 
normalidade, que chamem de rotina aquilo que só parece rotina 
para quem esqueceu como é estar inteiro. 

O Império venceu, eles repetem isso com calma, como se a repetição 
tornasse a mentira menos afiada; a Federação Arcana não foi 
simplesmente derrotada, foi riscada da fala comum, apagada como se 
alguém tivesse passado a mão numa página cheia de nomes que nunca 
mereceram existir, e a Fenda fez exatamente o que prometeram que 
faria, o que prova que não foi erro técnico o que aconteceu ali, 
foi escolha com consequências que ninguém calculou direito, 
achando que se podia encerrar o que foi aberto, e desde então 
o mundo não acabou, apenas deixou de saber fechar suas próprias feridas.

Greyspire sustenta-se enquanto sabe esconder o que a sustenta, 
e por isso não a chamem de cidade que vive; é uma cidade que é 
mantida, conserva-se por medida, por prática institucionalizada, 
cada pessoa que nasce recebe uma runa que pouco diz sobre destino 
e muito diz sobre controle, marca que serve para identificação 
e para decidir quem fica, quem se move, quem é observado, 
e os sermões da Liturgia falam em ordem espiritual com uma voz 
que soa oficial e seca, enquanto em salas que não aparecem nos 
mapas oficiais acontecem coisas que não são ditas em voz alta: 
eu vi corredores com portas que ninguém registra, vi salas onde 
se repetem rituais sem comunicado público, vi corpos voltando 
diferentes de como saíram; eu digo isto porque sei o suficiente 
para ter medo, e porque sei que a drenagem, se é preciso dar nome 
ao que vi, não é coisa de praça nem de boato, é segredo de casta, 
é prática que se faz atrás de cortinas grossas e que só se 
pronuncia com cuidado, como quem revela um pecado que corrói a garganta.

A magia existe, claro que existe, mas não como no livro didático; 
cada conjuro custa algo que não volta, às vezes sono, às vezes 
um sentimento, às vezes um nome que se apaga, e já vi mestres 
que falam como se as palavras fossem serras dentro da boca, 
e a Engrenagem Perpétua gira lá embaixo não como motor que move 
rodas, mas como dispositivo que compensa vazios, que adia o 
colapso por turnos e listas, e por isso chamam aquilo de 
manutenção, como se fosse possível domesticar um mal com papel 
e carimbo; só que agora algo mudou e não é sutileza de estatística, 
é sensação, e eu sinto: ela gira mais rápido, o número dos que 
deixam de ser contados aumentou, runas mudam sem dedo que escreva, 
bairros inteiros parecem sonhar acordados e sair pela manhã para 
andar em ruas que já não são exatamente ruas, pessoas voltam de 
lugares proibidos com palavras gravadas na pele, crianças nascem 
com marcas que não constam em nenhum livro, arquivos reescrevem-se 
sozinhos quando a cidade fecha os olhos.

Vocês foram riscados das listas, mas não da memória que importa, 
e lembram de mim quando ninguém mais lembra, e isso é o erro 
que a cidade vai corrigir se vocês demorarem. Por isso venham. 

Não perguntem, não procurem provas, não tentem achar meu nome 
em arquivo algum porque já o arrancaram de todo lugar que pudesse 
apontá-lo; simplesmente apareçam no Ferrugem & Ossos, 
no bairro Velha Chama, atrás do moinho cujas janelas foram muradas, 
antes da ponte que surge apenas quando chove, e venham enquanto 
ainda conseguem lembrar quem eram antes de serem anotados. 

Se chegarem cedo, talvez eu ainda esteja à mesa tentando juntar 
palavras que não se deixam prender. 
Se chegarem tarde, talvez eu ainda respire. 
Se chegarem muito tarde, talvez não reste nada em que vocês 
se reconheçam quando olharem para trás. 

Não peço confiança. 
Quero que saibam que já fazem parte da revolução.
        `;

        // --- VARIÁVEIS GLOBAIS ---
        let scene, camera, renderer;
        let sound;
        let crawlGroup, textMesh, textHeight;
        let animationInProgress = false;
        let endThreshold = 0;
        let clock = new THREE.Clock(); 

        const TEMPO_EXPLOSAO_SELO_MS = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--tempo-explosao-selo')) * 1000;
        const ARCANE_PURPLE = new THREE.Color(getComputedStyle(document.documentElement).getPropertyValue('--cor-arcana').trim());

        // --- INICIALIZAÇÃO ---
        function init() {
            setupAudio();
            setupScene();
            setupListeners();
            // A animação 3D é criada no clique
        }

        function setupAudio() {
            sound = new Howl({
                src: ['./ritual.wav'], // Use o áudio gerado
                loop: true,
                volume: 0.8
            });
        }

        function setupScene() {
            const canvas = document.getElementById('three-canvas');
            scene = new THREE.Scene();

            const aspect = window.innerWidth / window.innerHeight;
            // Câmera ajustada para o texto "quadrado" (sem rotação)
            camera = new THREE.PerspectiveCamera(50, aspect, 1, 10000);
            camera.position.set(0, 0, 500); // Posição central, olhando reto
            camera.lookAt(0, 0, 0);
            scene.add(camera);

            renderer = new THREE.WebGLRenderer({
                canvas: canvas,
                antialias: true,
                alpha: true // Fundo transparente
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        }

        function setupListeners() {
            document.getElementById('seal-container').addEventListener('click', startExperience, { once: true });
            window.addEventListener('resize', onWindowResize);
        }

        function startExperience() {
            if (animationInProgress) return;
            animationInProgress = true;

            const sealContainer = document.getElementById('seal-container');
            const canvas = document.getElementById('three-canvas');

            // 1. Ativa o áudio
            sound.play();
            
            // 2. Ativa a explosão do Selo (CSS)
            sealContainer.classList.add('clicked');
            sealContainer.style.pointerEvents = 'none';

            // 3. Oculta o selo e inicia o 3D após a explosão
            setTimeout(() => {
                sealContainer.style.display = 'none'; 
                
                // 4. Cria o texto 3D e o torna visível
                createCrawlText();
                canvas.classList.add('visible');
                
                // 5. Inicia o loop de animação 3D
                animate();

            }, TEMPO_EXPLOSAO_SELO_MS); 
        }

        function createCrawlText() {
            const textCanvas = createTextCanvas(LOREM_IPSUM_ARCANO);
            textHeight = textCanvas.height; 

            const texture = new THREE.CanvasTexture(textCanvas);
            texture.minFilter = THREE.LinearFilter;
            texture.magFilter = THREE.LinearFilter;

            const material = new THREE.ShaderMaterial({
                uniforms: {
                    map: { value: texture },
                    time: { value: 0.0 },
                    glowColor: { value: ARCANE_PURPLE },
                    // Efeito atenuado: 0.005 (0.015 era o anterior)
                    distortionStrength: { value: 0.005 } 
                },
                vertexShader: document.getElementById('vertexShader').textContent,
                fragmentShader: document.getElementById('fragmentShader').textContent,
                transparent: true,
                side: THREE.DoubleSide
            });

            const geometry = new THREE.PlaneGeometry(textCanvas.width, textHeight);
            textMesh = new THREE.Mesh(geometry, material);

            crawlGroup = new THREE.Group();
            crawlGroup.add(textMesh);
            
            // Rotação removida (formato "quadrado")
            crawlGroup.rotation.x = 0; 

            // Posição inicial (abaixo da tela)
            const startY = -textHeight / 2 - (window.innerHeight / 2); 
            crawlGroup.position.y = startY;

            // Define o ponto final da rolagem
            endThreshold = (textHeight / 2) + (window.innerHeight / 2);

            scene.add(crawlGroup);
        }

        function createTextCanvas(text) {
            const lines = text.split('\n');
            const fontSize = 36; // Tamanho reduzido para prosa densa
            const lineHeight = fontSize * 1.5; // Espaçamento maior para leitura
            
            const canvasHeight = lines.length * lineHeight + (fontSize * 2);
            const canvasWidth = 800; // Mais estreito (formato "quadrado")

            const canvas = document.createElement('canvas');
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            
            const ctx = canvas.getContext('2d');
            
            ctx.font = `${fontSize}px 'Lora'`; // Fonte mais legível para prosa
            ctx.fillStyle = '#FFFFFF'; 
            ctx.textAlign = 'center';
            
            ctx.shadowColor = 'transparent'; 
            ctx.shadowBlur = 0;

            let y = fontSize * 2;
            for (const line of lines) {
                ctx.fillText(line.trim(), canvasWidth / 2, y);
                y += lineHeight;
            }

            return canvas;
        }

        // --- LOOP DE ANIMAÇÃO ---
        function animate() {
            if (!animationInProgress) return;
            requestAnimationFrame(animate);

            const elapsedTime = clock.getElapsedTime();

            // Atualiza o tempo para o shader (pulsação/distorção)
            if (textMesh && textMesh.material && textMesh.material.uniforms.time) {
                textMesh.material.uniforms.time.value = elapsedTime;
            }

            // Velocidade da rolagem (aumentada para o texto longo)
            crawlGroup.position.y += 0.35; 

            // Verifica se o texto terminou de rolar
            if (crawlGroup.position.y > endThreshold) {
                finishAnimation();
            }

            renderer.render(scene, camera);
        }

        function finishAnimation() {
            animationInProgress = false;

            // 1. Remove o canvas 3D
            const canvas = document.getElementById('three-canvas');
            canvas.style.opacity = '0'; // Fade out
            
            // 2. Libera recursos 3D
            if (crawlGroup) {
                scene.remove(crawlGroup);
                if (textMesh.geometry) textMesh.geometry.dispose();
                if (textMesh.material) {
                    if (textMesh.material.map) textMesh.material.map.dispose();
                    textMesh.material.dispose();
                }
            }
            
            // 3. Para o áudio
            sound.fade(sound.volume(), 0, 1000); // Fade out do áudio

            // 4. Mostra a Assinatura Corrompida
            const signature = document.getElementById('signature-container');
            signature.style.display = 'block';
            setTimeout(() => {
                signature.style.opacity = '1';
            }, 500); // Atraso para o fade out do canvas
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();
    </script>
</body>
</html>


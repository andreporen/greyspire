name: Auto Deploy Greyspire

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Remove only index/css/js
        run: |
          rm -f index.html
          rm -rf css
          rm -rf js

      - name: Recreate folders
        run: |
          mkdir -p css
          mkdir -p js

      - name: Generate index.html
        run: |
          printf "%s" "<!doctype html>
<html>
<head>
  <meta charset=\"utf-8\" />
  <meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />
  <title>Carta de Greyspire</title>
  <link href=\"https://fonts.googleapis.com/css2?family=Uncial+Antiqua&family=MedievalSharp&display=swap\" rel=\"stylesheet\">
  <link rel=\"stylesheet\" href=\"css/estilo.css\">
</head>
<body>

<main class=\"pergaminho\" id=\"pergaminho\">
  <canvas id=\"fxCanvas\" class=\"fx-canvas\"></canvas>

  <button id=\"seloBtn\" class=\"selo-btn\" aria-label=\"Abrir carta\">
    <img src=\"img/selo.png\" alt=\"Selo arcano\" class=\"selo-img\" />
  </button>

  <section class=\"carta\" id=\"carta\" role=\"region\" aria-hidden=\"true\">
    <div class=\"conteudo\" id=\"conteudo\">

      <!-- TEXTO DA CARTA -->
      <p>Cidade de Greyspire, remanescentes do Velho Império, 537 D.R</p>
      <p>Vocês deviam ter percebido, mas a percepção é coisa perigosa por aqui...</p>

    </div>

    <div class=\"assinatura-wrap\">
      <div id=\"assinatura\" class=\"assinatura\" aria-hidden=\"true\" data-text=\"Arcanista-mor Amaris Solun\">
        <span class=\"visually-hidden\">Arcanista-mor Amaris Solun</span>
      </div>
    </div>
  </section>
</main>

<audio id=\"ritualAudio\" src=\"audio/ritual.mp3\" preload=\"auto\" loop></audio>
<script src=\"js/ritual.js\" defer></script>

</body>
</html>
" > index.html

      - name: Generate CSS
        run: |
          printf "%s" ":root{
  --bg:#0b0a09;
  --purple:#b24cff;
  --bpm:60;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  background:var(--bg);
  display:grid; place-items:center;
  color:#0a0a0a;
  font-family:\"Uncial Antiqua\", serif;
  -webkit-font-smoothing:antialiased;
}

.pergaminho{
  position:relative;
  width:min(920px,94vw);
  min-height:min(760px,86vh);
  overflow:hidden;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  border-radius:14px;
  box-shadow:0 30px 80px rgba(0,0,0,.7);
  background:#bca97b url(\"../img/pergaminho_base.jpg\") center/cover no-repeat;
  filter:saturate(1.05) contrast(1.1) brightness(0.97);
  isolation:isolate;
  transition:filter 1.4s ease;
}
.pergaminho.revealed{ filter:saturate(1.12) brightness(1.03); }

.selo-btn{
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  border:0; background:transparent; cursor:pointer; z-index:3;
}
.selo-img{ width:180px; height:180px; display:block; }

.carta{
  position:relative; z-index:2;
  width:84%; max-width:820px; min-height:520px;
  padding:28px; border-radius:6px;
  text-align:justify;
  opacity:0;
  transition:opacity .8s ease;
}
.pergaminho.revealed .carta{ opacity:1; }

.assinatura-wrap{ margin-top:22px; display:flex; justify-content:flex-start; }

.assinatura{
  position:relative;
  font-family:\"MedievalSharp\", cursive;
  font-size:26px; letter-spacing:.04em;
  color:#0a0a0a;
  opacity:0;
  transition:opacity 1.2s ease, transform 1.2s ease;
}
.pergaminho.revealed .assinatura{ opacity:1; transform:scale(1); }

" > css/estilo.css

      - name: Generate JS
        run: |
          printf "%s" "const seloBtn = document.getElementById('seloBtn');
const pergaminho = document.getElementById('pergaminho');
const carta = document.getElementById('carta');
const assinatura = document.getElementById('assinatura');
const ritualAudio = document.getElementById('ritualAudio');

let audioStarted = false;

function revelarCarta() {
  seloBtn.classList.add('hidden');
  pergaminho.classList.add('revealed');
  carta.setAttribute('aria-hidden', 'false');

  if (!audioStarted) {
    ritualAudio.volume = 0.8;
    ritualAudio.play().catch(() => {});
    audioStarted = true;
  }
}

seloBtn.addEventListener('click', revelarCarta);
" > js/ritual.js

      - name: Commit & Push
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add -A
          git commit -m "Auto deploy" || echo "Nada para commitar"
          git push
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4

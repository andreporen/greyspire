/* ================================
   Greyspire Ritual JS
   - Selo desaparece ao clicar
   - Carta revela com animação
   - Pergaminho pulsa no BPM do áudio
   - Assinatura ganha efeito corrompido + partículas
   ================================= */

const seloBtn = document.getElementById("seloBtn");
const pergaminho = document.getElementById("pergaminho");
const carta = document.getElementById("carta");
const assinatura = document.getElementById("assinatura");
const ritualAudio = document.getElementById("ritualAudio");

let audioStarted = false;

function revelarCarta() {
  // Oculta o selo
  seloBtn.classList.add("hidden");

  // Mostra o conteúdo da carta
  pergaminho.classList.add("revealed");
  carta.setAttribute("aria-hidden", "false");

  // Inicia pulsação visual
  pergaminho.classList.add("pulse");

  // Mostra assinatura com atraso dramático
  setTimeout(() => assinatura.classList.add("revealed"), 900);

  // Começa som (só na interação do usuário)
  if (!audioStarted) {
    ritualAudio.volume = 0.8;
    ritualAudio.play().catch(() => {});
    audioStarted = true;
  }

  iniciarParticulas();
}

// Evento principal
seloBtn.addEventListener("click", revelarCarta);


/* ================================
   Partículas leves perto da assinatura
   ================================ */

function criarParticula() {
  const p = document.createElement("div");
  p.className = "spark";
  const rect = assinatura.getBoundingClientRect();
  p.style.left = rect.left + rect.width * Math.random() + "px";
  p.style.top = rect.top + rect.height + 8 + "px";
  document.body.appendChild(p);
  setTimeout(() => p.remove(), 1500);
}

function iniciarParticulas() {
  setInterval(criarParticula, 1200);
}


/* ================================
   Futura área para shader WebGL
   (Canvas já está no HTML)
   ================================ */

const canvas = document.getElementById("fxCanvas");
const gl = canvas.getContext("webgl", { preserveDrawingBuffer: true });

function ajustarCanvas() {
  canvas.width = pergaminho.clientWidth;
  canvas.height = pergaminho.clientHeight;
}
ajustarCanvas();
window.addEventListener("resize", ajustarCanvas);

// Shader será adicionado depois (versão B do deploy)
